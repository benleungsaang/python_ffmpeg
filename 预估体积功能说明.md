# 视频转码工具 - 预估体积功能说明

## 功能概述

本版本新增了预估输出体积功能，根据视频文件的码率和时长计算预估输出体积，仅在预估体积小于原文件体积时才执行转码，否则直接复制原文件并改名。

## 计算方法

### 1. 获取源文件视频平均码率（bps）
- 通过 `ffprobe` 获取视频流的码率
- 若未获取到码率，用文件大小和时长计算：`码率 = (文件大小 × 8) / 时长`

### 2. 计算目标 maxrate
- 目标 maxrate = min(源码率 × 90%, 8.5Mbps)
- 即目标码率不超过8.5Mbps且不超过源码率的90%

### 3. 预估输出体积
- 预估体积 = (目标视频码率 + 音频码率) × 时长 / 8 × 1.01
- 其中音频码率为128kbps，1.01为1%的额外开销

### 4. 判断逻辑
- 若预估体积 ≥ 原文件体积：直接复制原文件并改名，记录状态为"预估体积为 xx MB，执行改名不转码"
- 若预估体积 < 原文件体积：执行正常转码流程

## 状态显示

在任务列表的"转码状态"列中，将显示以下信息：
- `预估体积为 10.23 MB，执行改名不转码` - 表示预估体积大于等于原文件，执行复制改名
- `执行中（预估体积为 5.67 MB）` - 表示预估体积小于原文件，执行转码
- `执行中（预估失败）` - 表示预估体积失败，直接执行转码

## 配置参数

- `AUDIO_BITRATE`: 音频码率，128kbps (128000 bps)
- `MAX_MAXRATE`: 最大视频码率，8.5Mbps (8500000 bps)

## 注意事项

1. 该功能需要系统安装 `ffmpeg` 和 `ffprobe`
2. 如果预估功能失败，程序将直接执行转码确保功能正常
3. 复制文件操作保留原文件的所有元数据
4. 复制操作的时间记录为0秒，因为复制速度很快